option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: leave_management.wsgi:application

packages:
  yum:
    git: []
    libjpeg-turbo-devel: []
    zlib-devel: []

commands:
  01_migrate:
    command: "source /var/app/venv/*/bin/activate && python manage.py migrate --noinput"
    ignoreErrors: true
  02_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput"
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_create_superuser.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # This hook runs after deployment. It won't prompt for input; set env vars for automation.
      if [ -n "$CEO_EMAIL" ] && [ -n "$CEO_PASSWORD" ]; then
        echo "Creating CEO user from env vars..."
        python manage.py create_ceo --email="$CEO_EMAIL" --password="$CEO_PASSWORD" || true
      fi
